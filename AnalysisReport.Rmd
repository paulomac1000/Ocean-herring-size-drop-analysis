---
title: "Analiza spadku wielkości śledzia oceanicznego"
author: "Paweł Maciejewski"
date: "23 01 2020"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Opis problemu

Na przestrzeni ostatnich lat zauważono stopniowy spadek rozmiaru śledzia oceanicznego wyławianego w Europie. Do analizy zebrano pomiary śledzi i warunków w jakich żyją z ostatnich 60 lat. Dane były pobierane z połowów komercyjnych jednostek. W ramach połowu jednej jednostki losowo wybierano od 50 do 100 sztuk trzyletnich śledzi.

## Wnioski

TODO

## Biblioteki

```{r libraries, message=FALSE}

library(dplyr)
library(knitr)
library(pander)
library(tidyverse)

```

## Ładowanie i prezentacja danych

Dane zostana załadowane bezpośrednio z pliku csv pochodzącego ze strony z zadaniem.

```{r load, cache=TRUE}

download.file(
  "http://www.cs.put.poznan.pl/dbrzezinski/teaching/sphd/sledzie.csv",
  destfile = 'sledzie.csv'
)

data <- read.csv("sledzie.csv", header = TRUE, sep = ",", na.strings = "?") %>% rename(id = X)

```



```{r stats, include=FALSE}

colNamesConcatenated <- paste(colnames(data), sep=", ")
colCount <- ncol(data)
rowCount <- nrow(data)

```

Zbiór zawiera `r colCount` kolumn i `r rowCount` wierszy. Kolumny mają następujące nazwy: `r colNamesConcatenated`. Prezentacja pierwszych 10 wierszy:

```{r kable}

kable(head(data, 10))

```

Opis kolumn:

Nazwa | Opis
---------|--------------------------------------------
length: | długość złowionego śledzia [cm]
cfin1:  | dostępność planktonu [zagęszczenie Calanus finmarchicus gat. 1]
cfin2:  | dostępność planktonu [zagęszczenie Calanus finmarchicus gat. 2]
chel1:  | dostępność planktonu [zagęszczenie Calanus helgolandicus gat. 1]
chel2:  | dostępność planktonu [zagęszczenie Calanus helgolandicus gat. 2]
lcop1:  | dostępność planktonu [zagęszczenie widłonogów gat. 1]
lcop2:  | dostępność planktonu [zagęszczenie widłonogów gat. 2]
fbar:   | natężenie połowów w regionie [ułamek pozostawionego narybku]
recr:   | roczny narybek [liczba śledzi]
cumf:   | łączne roczne natężenie połowów w regionie [ułamek pozostawionego narybku]
totaln: | łączna liczba ryb złowionych w ramach połowu [liczba śledzi]
sst:    | temperatura przy powierzchni wody [°C]
sal:    | poziom zasolenia wody [Knudsen ppt]
xmonth: | miesiąc połowu [numer miesiąca]
nao:    | oscylacja północnoatlantycka [mb]

Wiersze w zbiorze są uporządkowane chronologicznie.

## Opis danych

Prezentacja typów kolumn:

```{r description}

glimpse(data)

```

## Podsumowanie rozkładów

```{r summary}

pander(summary(data))

```
## Brakujące dane

```{r missing_data, include=FALSE}

completeRowsVector <- complete.cases(data)
completeRows <- data[completeRowsVector, ]
completeRowsCount <- nrow(completeRows)
allRowsCount <- nrow(data)
percentOfCompleteRows <- round(completeRowsCount/allRowsCount * 100, 2)
percentOfIncompleteRows <- 100.0 - percentOfCompleteRows

```

Zbiór zawiera `r completeRowsCount` kompletnych wierszy ze `r allRowsCount` wszystkich, co stanowi `r percentOfCompleteRows`%. Więc `r percentOfIncompleteRows`% to dane niekompletne, co stanowi dość dużą wartość. Uzupełnione zostaną średnią wartością danej kolumny zbioru.

``` {r repleace_missing_data}

for(i in 1:ncol(data)){
  data[is.na(data[,i]), i] <- mean(data[,i], na.rm = TRUE)
}

```

```{r missing_data_after_repleacing, include=FALSE}

completeRowsVector <- complete.cases(data)
completeRows <- data[completeRowsVector, ]
completeRowsCount <- nrow(completeRows)
allRowsCount <- nrow(data)
percentOfCompleteRows <- round(completeRowsCount/allRowsCount * 100, 2)

```

Zbiór zawiera teraz `r percentOfCompleteRows`% kompletnych wierszy.

## Analiza ekstremalnych wartości

Analizie zostanie poddany każdy parametr zbioru (poza id). Do tego celu zostanie użyta implementacja wykresu pudełkowego (ang. boxplot). Procent danych odstających dla każdej kolumny zostanie zaprezentwany na wykresie.

```{r show_boxplots, include=FALSE}

allCount = length(data)

allOut <- vector(mode = "list")

allOut['length'] = round(length(boxplot(data$length, plot=FALSE)$out) / allCount * 100, 2)
allOut['cfin1'] = round(length(boxplot(data$cfin1, plot=FALSE)$out) / allCount * 100, 2)
allOut['cfin2'] = round(length(boxplot(data$cfin2, plot=FALSE)$out) / allCount * 100, 2)
allOut['chel1'] = round(length(boxplot(data$chel1, plot=FALSE)$out) / allCount * 100, 2)
allOut['chel2'] = round(length(boxplot(data$chel2, plot=FALSE)$out) / allCount * 100, 2)
allOut['chel2'] = round(length(boxplot(data$chel2, plot=FALSE)$out) / allCount * 100, 2)
allOut['lcop2'] = round(length(boxplot(data$lcop2, plot=FALSE)$out) / allCount * 100, 2)
allOut['fbar'] = round(length(boxplot(data$fbar, plot=FALSE)$out) / allCount * 100, 2)
allOut['recr'] = round(length(boxplot(data$recr, plot=FALSE)$out) / allCount * 100, 2)
allOut['cumf'] = round(length(boxplot(data$cumf, plot=FALSE)$out) / allCount * 100, 2)
allOut['totaln'] = round(length(boxplot(data$totaln, plot=FALSE)$out) / allCount * 100, 2)
allOut['sst'] = round(length(boxplot(data$sst, plot=FALSE)$out) / allCount * 100, 2)
allOut['sal'] = round(length(boxplot(data$sal, plot=FALSE)$out) / allCount * 100, 2)
allOut['xmonth'] = round(length(boxplot(data$xmonth, plot=FALSE)$out) / allCount * 100, 2)
allOut['nao'] = round(length(boxplot(data$nao, plot=FALSE)$out) / allCount * 100, 2)

```

```{r}

barplot(unlist(allOut), las=2, cex.names=.5)

```
Na podstawie wykresów obrazujących rozkład wartości można wnioskować że dla atrybutów sal oraz cfin1 występują wartości odstające.